<!DOCTYPE html>
<html>

<head>
    <title>The Idea</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body class="bg-light p-5">
    <div class="container" style="max-width: 500px;">
        <h2 class="mb-4">ðŸ’¡ Idea</h2>

        <div class="input-group mb-3">
            <input type="text" id="ideaInput" class="form-control" placeholder="Enter a new idea...">
            <button class="btn btn-primary" onclick="addIdea()">Save</button>
        </div>

        <ul id="ideaList" class="list-group">
        </ul>
    </div>

    <script>
        // 2. CONFIGURATION: Paste your API keys here
        const SUPABASE_URL = 'https://lxxrvfjbopvutawilbyl.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx4eHJ2Zmpib3B2dXRhd2lsYnlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwNDMzMjgsImV4cCI6MjA4MTYxOTMyOH0.vJekPuTjcZgygJLG0K-rObkXd5BJoqIqnhh2PHPNsTA';

        // Initialize the client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY, {
            db: {
                schema: "public"
            }
        });

        // 3. READ: Fetch ideas from the database
        async function fetchIdeas() {
            const list = document.getElementById('ideaList');
            list.innerHTML = 'Loading...';

            const { data, error } = await supabase
                .from('ideas')
                .select('*')
                .order('created_at', { ascending: false });

            if (error) {
                alert('Error fetching: ' + error.message);
                return;
            }

            // Clear and rebuild list
            list.innerHTML = '';
            data.forEach(idea => {
                const li = document.createElement('li');
                li.className = 'list-group-item d-flex justify-content-between align-items-center';

                const span = document.createElement('span');
                span.textContent = idea.content;

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-danger btn-sm';
                deleteBtn.innerHTML = '&times;'; // Red X
                deleteBtn.onclick = () => deleteIdea(idea.id);

                li.appendChild(span);
                li.appendChild(deleteBtn);
                list.appendChild(li);
            });
        }

        // 4. WRITE: Save a new idea
        async function addIdea() {
            const input = document.getElementById('ideaInput');
            const text = input.value;

            if (!text) return;

            const { error } = await supabase
                .from('ideas')
                .insert({ content: text });

            if (error) {
                alert('Error adding: ' + error.message);
            } else {
                input.value = ''; // Clear input
                fetchIdeas();     // Refresh list
            }
        }

        // 5. DELETE: Remove an idea
        async function deleteIdea(id) {
            const { error } = await supabase
                .from('ideas')
                .delete()
                .eq('id', id);

            if (error) {
                alert('Error deleting: ' + error.message);
            } else {
                fetchIdeas(); // Refresh list
            }
        }

        // Load ideas when page opens
        fetchIdeas();
    </script>
</body>

</html>